# 添加 OCR 辅助图片输入功能计划 (含状态提示)

在之前的方案基础上，我增加了 **UI 状态反馈机制**，确保用户在等待图片分析时有明确的感知。

## 1. 数据层改造 (SettingsRepository)
- 添加 `saveOcrModel` / `getOcrModel` 存储 OCR 模型设置。
- 添加 `isOcrEnabled` 存储 OCR 开关状态。

## 2. 设置页 UI 更新 (Settings UI)
- 添加 "OCR / 视觉辅助设置" 入口。
- 仅展示支持视觉的模型供选择。

## 3. 对话页 UI 更新 (Chat UI)
- **输入区**: 添加 OCR 开关，逻辑同前（不支持视觉的模型开启 OCR 后可传图）。
- **状态指示器 (新增)**:
  - 在聊天界面（如输入框上方或消息列表底部）添加状态提示。
  - 当 OCR 正在进行时，显示 **"正在分析图片..."** 的加载动画或文字提示。

## 4. 核心业务逻辑 (ChatViewModel)
- **状态管理**: 在 `ChatUiState` 中新增 `ocrStatus: String?` 字段。
- **发送流程**:
  1. **设置状态**: `_uiState.update { it.copy(ocrStatus = "正在分析图片...") }`
  2. **执行 OCR**: 使用提示词 "请详细描述这张图片的内容。如果图片中包含文字，请将文字完整转录出来。" 调用视觉模型。
  3. **清除状态**: 获取结果后，`ocrStatus = null`。
  4. **发送消息**: 将 "视觉分析结果 + 用户问题" 发送给主模型。
