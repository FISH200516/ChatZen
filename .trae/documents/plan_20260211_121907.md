# 实现全独立自定义主题（RGB、独立气泡、圆角头像）

我完全理解您的需求。我们将实现一个高度自由的主题系统，确保**用户气泡**和**AI气泡**可以**完全独立**地设置颜色，互不干扰，也不必强制跟随主题。

## 1. 基础依赖与数据存储
### 添加 Coil 依赖
- `app/build.gradle.kts` 添加 `io.coil-kt:coil-compose`。

### 扩展 SettingsRepository (独立存储)
我们将在数据层完全解耦各部分的配置：
- **全局主色**: `custom_theme_color` (RGB Int)
- **用户气泡独立配置**:
    - `user_bubble_color` (RGB Int, 独立存储，不依赖主色)
    - `user_bubble_use_theme` (Boolean, 是否跟随主色)
- **AI 气泡独立配置**:
    - `ai_bubble_color` (RGB Int, 独立存储，不依赖主色)
    - `ai_bubble_use_theme` (Boolean, 是否跟随主色)
- **通用外观**:
    - `global_corner_radius` (Float)
    - `user_avatar_uri` (String)

## 2. 主题系统重构 (ChatZenTheme)
`ChatZenTheme` 将成为一个颜色合成器：
1.  首先生成全局基础色板（Base Palette）。
2.  **独立覆盖 (Override)**：
    - 如果 `user_bubble_use_theme` 为 `false`，则强制将 `primaryContainer` 替换为 `user_bubble_color`。
    - 如果 `ai_bubble_use_theme` 为 `false`，则强制将 `secondaryContainer` 替换为 `ai_bubble_color`。
    - 自动计算适配的文本颜色（深色背景配白字，浅色背景配黑字）。

## 3. 设置页面开发 (ThemeSettingsScreen)
页面将分为三个独立的颜色配置区块，互不影响：

### A. 全局应用主题 (App Theme)
- 控制按钮、标题栏、选中状态等颜色。
- 提供 RGB 滑块自定义。

### B. 用户气泡设置 (User Bubble)
- **独立开关**："使用独立颜色"。
- **RGB 滑块**：仅在开关开启时显示，允许用户为自己的气泡调配任意 RGB 颜色。

### C. AI 气泡设置 (AI Bubble)
- **独立开关**："使用独立颜色"。
- **RGB 滑块**：仅在开关开启时显示，允许用户为 AI 的气泡调配任意 RGB 颜色。

### D. 外观与头像
- 全局圆角滑块。
- 头像上传与预览。

## 4. UI 组件开发
- **ChatAvatar**: 圆角矩形头像，支持显示图片或模型首字母。
- **ChatBubble**: 适配新的颜色系统，采用头像分离布局。

此方案确保了您想要的"用户气泡和AI气泡独立分开设置"的完全灵活性。
