# Settings Refactoring & Web Search Implementation Plan

## 1. Data Layer & Logic Implementation
### 1.1 Web Search Models & API
- Create `data/model/WebSearchProvider.kt` enum: `BYTEDANCE`, `BAIDU`, `BING`, `TAVILY`, `NONE`.
- Create `data/api/WebSearchApi.kt` defining Retrofit interfaces for each provider.
- Update `data/api/RetrofitClient.kt` to include `Retrofit` instances for these services.
- Create `data/repository/WebSearchRepository.kt`:
  - Manage the selected search provider.
  - Implement `search(query: String): String` logic for each provider.
  - Handle API key storage (delegating to `SettingsRepository` or `DataStore`).

### 1.2 Settings Persistence
- Update `data/repository/SettingsRepository.kt`:
  - Add `selectedWebSearchProvider` preference.
  - Add storage for Web Search API keys.
- Update `ui/screens/SettingsViewModel.kt`:
  - Expose `webSearchProvider` and API key management methods.

### 1.3 Chat Logic
- Update `ui/screens/ChatViewModel.kt`:
  - Add `isWebSearchEnabled` state.
  - Add `toggleWebSearch()` method.
  - Modify `sendMessage()`: If web search is enabled, call `WebSearchRepository.search(query)` first, then append results to the context sent to the LLM.

## 2. UI Implementation
### 2.1 Refactor Settings Screen
- Create `ui/screens/ServiceProvidersScreen.kt`:
  - Move the existing "Model Provider" configuration UI (list of providers, API key input, model fetching) from `SettingsScreen` to here.
- Create `ui/screens/WebSearchSettingsScreen.kt`:
  - Implement UI to select Web Search Provider.
  - Implement UI to input API Keys for the selected provider.
- Update `ui/screens/SettingsScreen.kt`:
  - Remove the direct provider configuration UI.
  - Add two main navigation items:
    1. **"Select Service Provider"** -> Navigates to `ServiceProvidersScreen`.
    2. **"Select Web Search Service"** -> Navigates to `WebSearchSettingsScreen`.

### 2.2 Chat Screen Enhancements
- Update `ui/screens/ChatScreen.kt`:
  - Add a **"Web Search"** toggle button next to the "Deep Thinking" button (above the input field).
  - Match the style of the "Deep Thinking" button.
  - Ensure it reflects the `isWebSearchEnabled` state.

### 2.3 Navigation
- Update `ui/navigation/ChatZenNavHost.kt`:
  - Add new routes: `service_providers` and `web_search_settings`.
  - Add `composable` destinations for `ServiceProvidersScreen` and `WebSearchSettingsScreen`.

## 3. String Resources
- Add necessary Chinese string resources to `res/values/strings.xml` (and `values-zh` if separate) for:
  - "Select Service Provider"
  - "Select Web Search Service"
  - "Web Search"
  - Provider names (ByteDance, Baidu, etc.)
  - API Key prompts.

## 4. Verification
- Verify Settings navigation works correctly.
- Verify Service Provider configuration still works in the new screen.
- Verify Web Search Provider can be selected and keys saved.
- Verify "Web Search" button toggles state.
- Verify sending a message with Web Search enabled triggers the search and includes results in the LLM context.
